"use strict";angular.module("thinkificChallengeFrontendApp",["ngAnimate","ngCookies","ui.router","ngStorage","angularModalService"]).config(["$stateProvider","$httpProvider","$locationProvider",function(a,b,c){b.interceptors.push(["$cookies",function(a){return{request:function(b){return a.get("token")&&(b.headers.Authorization="Token "+a.get("token")),b}}}]),a.state("landingPage",{url:"",templateUrl:"views/landingPage.html",controller:"LandingPageCtrl",requireLogin:!1}).state("register",{url:"/register",templateUrl:"views/register.html",controller:"RegisterCtrl",requireLogin:!1}).state("integer",{url:"/integer",templateUrl:"views/integer.html",controller:"IntegerCtrl",requireLogin:!0})}]).run(["$state","Auth","$rootScope",function(a,b,c){c.$on("$stateChangeStart",function(c,d){d.requireLogin&&!b.$isLoggedIn()&&(a.transitionTo("landingPage"),c.preventDefault()),!d.requireLogin&&b.$isLoggedIn()&&(a.transitionTo("integer"),c.preventDefault())})}]),angular.module("thinkificChallengeFrontendApp").controller("IntegerCtrl",["$scope","Integer","Auth","$localStorage","$cookies","$state","ModalService",function(a,b,c,d,e,f,g){a.getCurrentInteger=function(){b.$getCurrentInteger().then(function(b){a.openModal("Current Integer is ",b.data.current_integer)})["catch"](function(a){console.log(a.data)})},a.getNextInteger=function(){b.$getNextInteger().then(function(b){a.openModal("Next Integer is ",b.data.next_integer)})["catch"](function(a){console.log(a.data)})},a.setNewCurrentInteger=function(c){b.$setNewCurrentInteger(c).then(function(b){a.openModal("Current Integer is now ",b.data.current_integer)})["catch"](function(a){console.log(a.data)})},a.openModal=function(a,b){console.log(b),g.showModal({templateUrl:"views/modal_integer.html",controller:"ModalCtrl",inputs:{title:a,number:b}}).then(function(a){a.element.modal(),a.close.then(function(){})})},a.logout=function(a){c.$logout().then(function(a){d.$reset(),delete e.remove("token"),f.go("landingPage")})["catch"](function(a){console.log(a.data)})}}]),angular.module("thinkificChallengeFrontendApp").controller("ModalCtrl",["$scope","close","title","number",function(a,b,c,d){a.title=c,a.number=d}]),angular.module("thinkificChallengeFrontendApp").controller("RegisterCtrl",["$scope","Auth","Validate","$cookies","$state","$localStorage",function(a,b,c,d,e,f){a.loading=!1,a.newuser={},a.register=function(g){if(console.log(a.newuser),a.loading=!0,a.errors=[],c.form_validation(g,a.errors),!g.$invalid){var h={password1:a.newuser.password1,password2:a.newuser.password2,email:a.newuser.email};b.$register(h).then(function(b){d.put("token",b.data.key),f.isAuthenticated="true",a.loading=!1,e.go("integer")})["catch"](function(b){a.loading=!1,a.errors=b.data})}}}]),angular.module("thinkificChallengeFrontendApp").controller("LandingPageCtrl",["$scope","Auth","Validate","$cookies","$state","$localStorage",function(a,b,c,d,e,f){console.log("landing page"),a.login=function(g){console.log("pressed login"),a.errors=[],c.form_validation(g,a.errors),g.$invalid||b.$login(a.model.email,a.model.password).then(function(a){console.log(a.data.key),d.put("token",a.data.key),f.isAuthenticated="true",e.go("integer")})["catch"](function(b){a.errors=b.data})},a.gotoRegister=function(){console.log("gotoRegister"),e.go("register")}}]),angular.module("thinkificChallengeFrontendApp").factory("Auth",["$http","$cookies","$localStorage",function(a,b,c){var d={},e="http://thinkificapi.zeeshansafdar.com";return d.$login=function(b,c){return a({method:"POST",url:e+"/api/login/",data:{email:b,password:c}})},d.$isLoggedIn=function(){return"true"===c.isAuthenticated?!0:!1},d.$register=function(b){return a({method:"POST",url:e+"/api/registration/",data:b})},d.$logout=function(){return a({method:"POST",url:e+"/api/logout/"})},d}]),angular.module("thinkificChallengeFrontendApp").service("Validate",function(){return{message:{minlength:"This value is not long enough.",maxlength:"This value is too long.",email:"A properly formatted email address is required.",required:"This field is required."},more_messages:{demo:{required:"Here is a sample alternative required message."}},check_more_messages:function(a,b){return(this.more_messages[a]||[])[b]||null},validation_messages:function(a,b,c){var d=[];for(var e in b[a].$error)if(b[a].$error[e]){var f=this.check_more_messages(a,e);f?d.push(f):this.message[e]?d.push(this.message[e]):d.push("Error: "+e)}var g=[];angular.forEach(d,function(a,b){-1===g.indexOf(a)&&g.push(a)}),c&&(c[a]=g)},form_validation:function(a,b){for(var c in a)"$"!=c.substr(0,1)&&this.validation_messages(c,a,b)}}}),angular.module("thinkificChallengeFrontendApp").factory("Integer",["$http","$cookies","$localStorage",function(a,b,c){var d={},e="http://thinkificapi.zeeshansafdar.com";return d.$getCurrentInteger=function(){return a.get(e+"/api/currentint/")},d.$getNextInteger=function(){return a.get(e+"/api/nextint/")},d.$setNewCurrentInteger=function(b){return a({method:"PUT",url:e+"/api/currentint/",data:{current_integer:b}})},d}]);